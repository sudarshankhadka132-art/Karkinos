<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document Upload</title>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        margin: 2rem;
        color: #1f2937;
        background: #f9fafb;
      }

      main {
        max-width: 600px;
        margin: 0 auto;
        background: #ffffff;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
      }

      h1 {
        margin-bottom: 1rem;
        font-size: 1.75rem;
        font-weight: 600;
      }

      form {
        display: grid;
        gap: 1rem;
      }

      button {
        justify-self: flex-start;
        background: #2563eb;
        color: #ffffff;
        border: none;
        border-radius: 8px;
        padding: 0.65rem 1.5rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s ease;
      }

      button:hover {
        background: #1d4ed8;
      }

      .status {
        font-family: ui-monospace, "SFMono-Regular", SFMono, Menlo, Monaco,
          Consolas, "Liberation Mono", "Courier New", monospace;
        background: #0f172a;
        color: #f8fafc;
        padding: 1rem;
        border-radius: 8px;
        white-space: pre-wrap;
        word-break: break-word;
        max-height: 240px;
        overflow: auto;
      }
    </style>
  </head>
  <body>
    <main>
      <h1>Upload source documents</h1>
      <form id="upload-form">
        <label for="file-input">
          Choose one or more files to index into Karkinos intelligence engine.
        </label>
        <input id="file-input" name="files" type="file" multiple required />
        <button type="submit">Upload</button>
      </form>
      <section aria-live="polite" style="margin-top: 1.5rem">
        <h2 style="font-size: 1.125rem; margin-bottom: 0.5rem">Status</h2>
        <pre class="status" id="status">Waiting for upload…</pre>
      </section>
    </main>
    <script>
      const form = document.getElementById("upload-form");
      const status = document.getElementById("status");

      function setStatus(message) {
        status.textContent = message;
      }

      form.addEventListener("submit", async (event) => {
        event.preventDefault();
        const files = document.getElementById("file-input").files;
        if (!files || files.length === 0) {
          setStatus("Please select at least one file.");
          return;
        }

        const formData = new FormData();
        Array.from(files).forEach((file) => {
          formData.append("files", file, file.name);
        });

        setStatus("Uploading…");

        try {
          const response = await fetch("/api/documents", {
            method: "POST",
            body: formData,
          });

          if (!response.ok) {
            const errorText = await response.text();
            throw new Error(
              `Upload failed with status ${response.status}: ${errorText}`
            );
          }

          const payload = await response.json();
          setStatus(JSON.stringify(payload, null, 2));
        } catch (error) {
          console.error(error);
          setStatus(error.message || "An unexpected error occurred.");
        }
      });
    </script>
  </body>
</html>
